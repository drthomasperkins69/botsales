{% extends "base.html" %}

{% block title %}Dashboard | BotSales{% endblock %}

{% block extra_css %}
<style>
    .dashboard-page {
        padding: 2rem 0;
    }

    .dashboard-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
    }

    .dashboard-header h1 {
        font-size: 1.75rem;
    }

    /* Stats */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 1.5rem;
        margin-bottom: 2rem;
    }

    .stat-card {
        background: var(--white);
        border-radius: var(--radius-lg);
        padding: 1.5rem;
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .stat-icon {
        width: 3rem;
        height: 3rem;
        border-radius: var(--radius);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.25rem;
    }

    .stat-icon.blue { background: var(--primary-light); color: var(--primary); }
    .stat-icon.green { background: #D1FAE5; color: #059669; }
    .stat-icon.purple { background: #EDE9FE; color: #7C3AED; }
    .stat-icon.orange { background: #FFEDD5; color: #EA580C; }

    .stat-value {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--gray-900);
    }

    .stat-label {
        font-size: 0.875rem;
        color: var(--gray-500);
    }

    /* Dashboard grid */
    .dashboard-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 2rem;
    }

    .dashboard-section {
        background: var(--white);
        border-radius: var(--radius-lg);
        overflow: hidden;
    }

    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1.25rem 1.5rem;
        border-bottom: 1px solid var(--gray-200);
    }

    .section-header h2 {
        font-size: 1.125rem;
        font-weight: 600;
    }

    .section-body {
        padding: 1.5rem;
    }

    /* Listing item */
    .listing-item {
        display: flex;
        gap: 1rem;
        padding: 1rem;
        border-radius: var(--radius);
        transition: background 0.2s;
    }

    .listing-item:hover {
        background: var(--gray-50);
    }

    .listing-item + .listing-item {
        border-top: 1px solid var(--gray-100);
    }

    .listing-thumb {
        width: 80px;
        height: 60px;
        border-radius: var(--radius);
        overflow: hidden;
        background: var(--gray-200);
        flex-shrink: 0;
    }

    .listing-thumb img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .listing-info {
        flex: 1;
        min-width: 0;
    }

    .listing-info h4 {
        font-size: 0.9375rem;
        font-weight: 600;
        margin-bottom: 0.25rem;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .listing-info h4 a {
        color: var(--gray-900);
    }

    .listing-meta {
        display: flex;
        gap: 1rem;
        font-size: 0.8125rem;
        color: var(--gray-500);
    }

    .listing-price {
        font-weight: 700;
        color: var(--gray-900);
    }

    .listing-actions {
        display: flex;
        gap: 0.5rem;
    }

    .listing-actions .btn {
        padding: 0.375rem 0.75rem;
        font-size: 0.8125rem;
    }

    /* Status badge */
    .status-badge {
        display: inline-block;
        padding: 0.25rem 0.5rem;
        border-radius: var(--radius);
        font-size: 0.75rem;
        font-weight: 600;
    }

    .status-badge.active { background: #D1FAE5; color: #059669; }
    .status-badge.sold { background: var(--primary-light); color: var(--primary); }
    .status-badge.expired { background: var(--gray-200); color: var(--gray-600); }

    /* Messages */
    .message-item {
        display: flex;
        gap: 1rem;
        padding: 1rem;
        border-radius: var(--radius);
        transition: background 0.2s;
    }

    .message-item:hover {
        background: var(--gray-50);
    }

    .message-item + .message-item {
        border-top: 1px solid var(--gray-100);
    }

    .message-avatar {
        width: 2.5rem;
        height: 2.5rem;
        border-radius: var(--radius-full);
        background: var(--primary-light);
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--primary);
        font-weight: 600;
        flex-shrink: 0;
    }

    .message-content {
        flex: 1;
        min-width: 0;
    }

    .message-header {
        display: flex;
        justify-content: space-between;
        margin-bottom: 0.25rem;
    }

    .message-sender {
        font-weight: 600;
        font-size: 0.9375rem;
    }

    .message-time {
        font-size: 0.75rem;
        color: var(--gray-400);
    }

    .message-preview {
        font-size: 0.875rem;
        color: var(--gray-600);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .message-unread .message-sender {
        color: var(--primary);
    }

    /* Empty state */
    .empty-state {
        text-align: center;
        padding: 2rem;
        color: var(--gray-500);
    }

    .empty-state i {
        font-size: 2.5rem;
        color: var(--gray-300);
        margin-bottom: 0.75rem;
    }

    /* Quick actions */
    .quick-actions {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
    }

    .quick-action {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.75rem 1rem;
        background: var(--gray-50);
        border-radius: var(--radius);
        color: var(--gray-700);
        transition: all 0.2s;
    }

    .quick-action:hover {
        background: var(--primary-light);
        color: var(--primary);
    }

    .quick-action i {
        width: 1.5rem;
        text-align: center;
    }

    @media (max-width: 1024px) {
        .stats-grid {
            grid-template-columns: repeat(2, 1fr);
        }

        .dashboard-grid {
            grid-template-columns: 1fr;
        }
    }

    @media (max-width: 768px) {
        .stats-grid {
            grid-template-columns: 1fr;
        }

        .listing-item {
            flex-wrap: wrap;
        }

        .listing-actions {
            width: 100%;
            margin-top: 0.5rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <div class="dashboard-page">
        <div class="dashboard-header">
            <div>
                <h1>Welcome back, {{ current_user.first_name or current_user.username }}!</h1>
                <p class="text-muted">Here's what's happening with your listings.</p>
            </div>
            <a href="{{ url_for('create_listing') }}" class="btn btn-primary">
                <i class="fas fa-plus"></i> Create Listing
            </a>
        </div>

        <!-- Stats -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon blue">
                    <i class="fas fa-robot"></i>
                </div>
                <div>
                    <div class="stat-value">{{ active_listings|length }}</div>
                    <div class="stat-label">Active Listings</div>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon green">
                    <i class="fas fa-eye"></i>
                </div>
                <div>
                    <div class="stat-value">{{ total_views }}</div>
                    <div class="stat-label">Total Views</div>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon purple">
                    <i class="fas fa-envelope"></i>
                </div>
                <div>
                    <div class="stat-value">{{ total_inquiries }}</div>
                    <div class="stat-label">Inquiries</div>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon orange">
                    <i class="fas fa-heart"></i>
                </div>
                <div>
                    <div class="stat-value">{{ saved|length }}</div>
                    <div class="stat-label">Saved Robots</div>
                </div>
            </div>
        </div>

        <div class="dashboard-grid">
            <!-- Main content -->
            <div>
                <!-- Active Listings -->
                <div class="dashboard-section mb-4">
                    <div class="section-header">
                        <h2>Your Active Listings</h2>
                        <a href="{{ url_for('create_listing') }}" class="btn btn-sm btn-primary">
                            <i class="fas fa-plus"></i> Add New
                        </a>
                    </div>
                    <div class="section-body">
                        {% if active_listings %}
                            {% for listing in active_listings[:5] %}
                            <div class="listing-item">
                                <div class="listing-thumb">
                                    {% if listing.primary_image %}
                                        <img src="{{ url_for('uploaded_file', filename=listing.primary_image) }}" alt="">
                                    {% endif %}
                                </div>
                                <div class="listing-info">
                                    <h4><a href="{{ url_for('listing_detail', id=listing.id) }}">{{ listing.title }}</a></h4>
                                    <div class="listing-meta">
                                        <span class="listing-price">${{ "{:,.0f}".format(listing.price) }}</span>
                                        <span><i class="fas fa-eye"></i> {{ listing.views }} views</span>
                                        <span><i class="fas fa-envelope"></i> {{ listing.inquiries }} inquiries</span>
                                    </div>
                                </div>
                                <div class="listing-actions">
                                    <a href="{{ url_for('edit_listing', id=listing.id) }}" class="btn btn-sm btn-secondary">Edit</a>
                                    <form action="{{ url_for('mark_sold', id=listing.id) }}" method="POST" style="display: inline;">
                                        <button type="submit" class="btn btn-sm btn-outline">Mark Sold</button>
                                    </form>
                                </div>
                            </div>
                            {% endfor %}
                        {% else %}
                            <div class="empty-state">
                                <i class="fas fa-robot"></i>
                                <p>You don't have any active listings yet.</p>
                                <a href="{{ url_for('create_listing') }}" class="btn btn-primary">Create Your First Listing</a>
                            </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Sold Listings -->
                {% if sold_listings %}
                <div class="dashboard-section">
                    <div class="section-header">
                        <h2>Recently Sold</h2>
                    </div>
                    <div class="section-body">
                        {% for listing in sold_listings[:3] %}
                        <div class="listing-item">
                            <div class="listing-thumb">
                                {% if listing.primary_image %}
                                    <img src="{{ url_for('uploaded_file', filename=listing.primary_image) }}" alt="">
                                {% endif %}
                            </div>
                            <div class="listing-info">
                                <h4><a href="{{ url_for('listing_detail', id=listing.id) }}">{{ listing.title }}</a></h4>
                                <div class="listing-meta">
                                    <span class="listing-price">${{ "{:,.0f}".format(listing.price) }}</span>
                                    <span class="status-badge sold">Sold</span>
                                    <span>{{ listing.sold_at.strftime('%d %b %Y') if listing.sold_at else '' }}</span>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            </div>

            <!-- Sidebar -->
            <div>
                <!-- Recent Messages -->
                <div class="dashboard-section mb-4">
                    <div class="section-header">
                        <h2>Recent Messages</h2>
                        <a href="{{ url_for('messages') }}" class="text-primary" style="font-size: 0.875rem;">View All</a>
                    </div>
                    <div class="section-body">
                        {% if recent_messages %}
                            {% for msg in recent_messages %}
                            <a href="{{ url_for('message_thread', thread_id=msg.thread_id) }}" class="message-item {{ 'message-unread' if not msg.is_read }}">
                                <div class="message-avatar">
                                    {{ msg.sender.username[0].upper() }}
                                </div>
                                <div class="message-content">
                                    <div class="message-header">
                                        <span class="message-sender">{{ msg.sender.full_name }}</span>
                                        <span class="message-time">{{ msg.created_at.strftime('%d %b') }}</span>
                                    </div>
                                    <div class="message-preview">{{ msg.body[:50] }}...</div>
                                </div>
                            </a>
                            {% endfor %}
                        {% else %}
                            <div class="empty-state">
                                <i class="fas fa-envelope"></i>
                                <p>No messages yet</p>
                            </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="dashboard-section">
                    <div class="section-header">
                        <h2>Quick Actions</h2>
                    </div>
                    <div class="section-body">
                        <div class="quick-actions">
                            <a href="{{ url_for('create_listing') }}" class="quick-action">
                                <i class="fas fa-plus"></i> Create New Listing
                            </a>
                            <a href="{{ url_for('saved_listings') }}" class="quick-action">
                                <i class="fas fa-heart"></i> View Saved Robots
                            </a>
                            <a href="{{ url_for('search_alerts') }}" class="quick-action">
                                <i class="fas fa-bell"></i> Manage Alerts
                            </a>
                            <a href="{{ url_for('account_settings') }}" class="quick-action">
                                <i class="fas fa-cog"></i> Account Settings
                            </a>
                            <a href="{{ url_for('valuation_tool') }}" class="quick-action">
                                <i class="fas fa-calculator"></i> Value My Robot
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
